!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t){t.exports=JSON.parse('{"idle":{"right":[{"ms":[1000,4000],"random":true,"cells":[[null,"b","b"],["|","_","|"],["!",null,"!"]]},{"ms":500,"cells":[[null,"d","d"],["|","_","|"],["!",null,"!"]]},{"ms":500,"cells":[[null,"L","L"],["|","_","|"],["!",null,"!"]]},{"ms":2500,"cells":[[null,"b","b"],["<","_","|"],["!",null,"!"]]},{"ms":2500,"cells":[[null,"b","b"],["|","_",">"],["!",null,"!"]]}],"left":[{"ms":8000,"cells":[["d","d",null],["|","_","|"],["!",null,"!"]]},{"ms":500,"cells":[["d","d",null],["|","_","|"],["!",null,"!"]]},{"ms":500,"cells":[["L","L",null],["|","_","|"],["!",null,"!"]]},{"ms":2500,"cells":[["d","d",null],["<","_","|"],["!",null,"!"]]},{"ms":2500,"cells":[["b","b",null],["|","_",">"],["!",null,"!"]]}]},"move":{"left":[{"ms":200,"cells":[["d","d",null],["|","_","|"],["\'",null,"!"]]},{"ms":200,"cells":[["d","d",null],["|","_","|"],["!",null,"\'"]]}],"right":[{"ms":200,"cells":[[null,"b","b"],["|","_","|"],["!",null,"\'"]]},{"ms":200,"cells":[[null,"b","b"],["|","_","|"],["\'",null,"!"]]}]}}')},function(t){t.exports=JSON.parse('{"idle":{"right":[{"ms":[500,1000],"random":true,"cells":[[null,"_"," ",null],["(","_","_",")"]]},{"ms":[500,1000],"random":true,"cells":[[null,"-",null],["(","_",")"]]}],"left":[{"ms":[500,1000],"random":true,"cells":[[null," ","_",null],["(","_","_",")"]]},{"ms":[500,1000],"random":true,"cells":[[null,"-",null],["(","_",")"]]}]},"move":{"right":[{"ms":[500,1000],"random":true,"cells":[[null,"_"," ",null],["(","_","_",")"]]},{"ms":[500,1000],"random":true,"cells":[[null,"-",null],["(","_",")"]]}],"left":[{"ms":[500,1000],"random":true,"cells":[[null," ","_",null],["(","_","_",")"]]},{"ms":[500,1000],"random":true,"cells":[[null,"-",null],["(","_",")"]]}]},"cooldown":{"right":[{"ms":[500,1000],"random":true,"cells":[[null,"_"," ",null],["(","_","_",")"]]},{"ms":[500,1000],"random":true,"cells":[[null,"-",null],["(","_",")"]]}],"left":[{"ms":[500,1000],"random":true,"cells":[[null," ","_",null],["(","_","_",")"]]},{"ms":[500,1000],"random":true,"cells":[[null,"-",null],["(","_",")"]]}]},"attack":{"right":[{"ms":30,"cells":[[null," ","_"," ",null],["(","_","_","_",")"]]},{"ms":30,"cells":[[null,null,"-",null,null],[null,"(","_",")",null]]}],"left":[{"ms":30,"cells":[[null," ","_"," ",null],["(","_","_","_",")"]]},{"ms":30,"cells":[[null,null,"-",null,null],[null,"(","_",")",null]]}]}}')},function(t,e,n){"use strict";function i(t){let e={};e.value=t,e.isDown=!1,e.isUp=!0,e.press=void 0,e.release=void 0,e.downHandler=t=>{t.key===e.value&&(e.isUp&&e.press&&e.press(),e.isDown=!0,e.isUp=!1,t.preventDefault())},e.upHandler=t=>{t.key===e.value&&(e.isDown&&e.release&&e.release(),e.isDown=!1,e.isUp=!0,t.preventDefault())};const n=e.downHandler.bind(e),i=e.upHandler.bind(e);return window.addEventListener("keydown",n,!1),window.addEventListener("keyup",i,!1),e.unsubscribe=()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",i)},e}n.r(e);var s=function(t,e,n){this.name=t,this.seen=e,this.is_visible=n,this.char=r[this.name]},r={wall:"#",floor:"."},o=function(){function t(){this.tiles={}}return t.prototype.setTile=function(t,e,n,i,r){this.tiles[e]||(this.tiles[e]={}),this.tiles[e][t]=new s(n,i,r)},t.prototype.updateRoom=function(t){var e=this;t.forEach((function(t){var n=t[0],i=n[0],s=n[1],r=t[1],o=t[2],l=o[0],a=o[1];e.setTile(i,s,r,l,a)}))},t}(),l=function(){function t(){this.x=0,this.y=0,this.spriteState="idle",this.direction="right"}return t.prototype.update=function(t){var e;e=t.coords,this.x=e[0],this.y=e[1],this.spriteState=t.sprite_state,this.direction=t.direction,this.isVisible=t.is_visible},t.prototype.tickSpriteState=function(t){this.sprite.tick(t,this.spriteState,this.direction)},t}(),a=n(0);var u,c=function(){function t(t,e,n,i,s){this.isRandom=t,this.msFrom=e,this.msTo=n,this.cells=i,this.idx=s}return t.prototype.makeCurrentFrame=function(){var t,e,n=this.msFrom;return this.isRandom&&(t=this.msFrom,e=this.msTo,n=Math.floor(Math.random()*(e-t+1)+t)),new h(n,this.cells,this.idx,0)},t}(),h=function(t,e,n,i){this.ms=t,this.cells=e,this.idx=n,this.timer=i},p=function(){function t(t){this.states={},this.load(t),console.log("sprite states",this.states),this.currentState="idle",this.currentDirection="right",this.currentFrame=this.getCurrentStateFrames()[0].makeCurrentFrame()}return t.prototype.load=function(t){var e=this;console.log("loading sprite data",t),Object.entries(t).forEach((function(t){var n=t[0],i=t[1];e.states[n]={},Object.entries(i).forEach((function(t){var i=t[0],s=t[1];e.states[n][i]=[],s.forEach((function(t,s){var r=0,o=null;t.ms.length>1?(r=t.ms[0],o=t.ms[1]):r=t.ms,t=new c(t.random,r,o,t.cells,s),e.states[n][i].push(t)}))}))}))},t.prototype.getCurrentStateFrames=function(){return this.states[this.currentState][this.currentDirection]},t.prototype.getCells=function(){return this.currentFrame.cells},t.prototype.tick=function(t,e,n){if(!this.currentState||e!=this.currentState||n!=this.currentDirection){console.log("new state",this.currentState,this.currentDirection),this.currentState=e,this.currentDirection=n;var i=this.getCurrentStateFrames()[0];this.currentFrame=i.makeCurrentFrame()}if(this.currentFrame.timer+=t,this.currentFrame.timer>this.currentFrame.ms/1e3){var s=(this.currentFrame.idx+1)%this.getCurrentStateFrames().length;i=this.getCurrentStateFrames()[s];this.currentFrame=i.makeCurrentFrame()}},t}(),f=(u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),d=function(t){function e(){var e=t.call(this)||this;return e.elementClass="player",e.hitPoints=100,e.sprite=new p(a),e}return f(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),e.hit_points<this.hitPoints&&(this.hitPoints=e.hit_points)},e}(l),m=n(1),y=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),w={blob:function(t){function e(){var e=t.call(this)||this;return e.elementClass="blob",e.hitPoints=100,e.sprite=new p(m),e}return y(e,t),e}(l)};window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/30)},new(function(){function t(t,e){this.sizeX=70,this.sizeY=30,this.gameDiv=t,this.guiDiv=e,this.lines=[],this.room=new o,this.player=new d,this.otherPlayers={},this.entities={},this.socket=null,this.init(),this.initNetwork(),this.initKeys()}return t.prototype.updateStateFromNetwork=function(t){var e=this;t.data.map&&this.room.updateRoom(t.data.map),t.data.self&&this.player.update(t.data.self),t.data.players&&Object.entries(t.data.players).forEach((function(t){var n=t[0],i=t[1];e.otherPlayers[n]||(e.otherPlayers[n]=new d),e.otherPlayers[n].update(i)})),t.data.entities&&Object.entries(t.data.entities).forEach((function(t){var n=t[0],i=t[1];if(!e.entities[n]){var s=i.type;e.entities[n]=new w[s]}e.entities[n].update(i)}))},t.prototype.initNetwork=function(){var t=this;this.socket=new WebSocket("wss://ascii.kwoh.de/connect"),this.socket.onopen=function(e){t.socket.onmessage=function(e){var n=JSON.parse(e.data);switch(n.type){case"init":console.log("init package!"),t.updateStateFromNetwork(n),t.start();break;case"update":t.updateStateFromNetwork(n);break;case"remove_players":n.data.forEach((function(e){delete t.otherPlayers[e]}));break;case"remove_entities":n.data.forEach((function(e){delete t.entities[e]}));break;default:console.log("unknown package ",n)}}}},t.prototype.send=function(t,e){this.socket&&this.socket.send(JSON.stringify({type:t,data:e}))},t.prototype.initKeys=function(){var t=this,e=i("a"),n=i("w"),s=i("d"),r=i("s");e.press=function(){t.send("actions",{left:"press"})},e.release=function(){t.send("actions",{left:"release"})},n.press=function(){t.send("actions",{up:"press"})},n.release=function(){t.send("actions",{up:"release"})},s.press=function(){t.send("actions",{right:"press"})},s.release=function(){t.send("actions",{right:"release"})},r.press=function(){t.send("actions",{down:"press"})},r.release=function(){t.send("actions",{down:"release"})}},t.prototype.init=function(){this.runs=!1,this.gameObjects=[],this.fps(30)},t.prototype.fps=function(t){this.currentFps=t||this.currentFps;this.currentFps;return this.currentFps},t.prototype.start=function(){0===this.gameObjects.length&&console.warn("No gameObjects in the Game."),this.startTime=Date.now(),this.lastTick=Date.now(),this.runs=!0,this.play(),console.info("Gameloop is running")},t.prototype.clearLines=function(){this.lines=[];for(var t=0;t<this.sizeY;t++){for(var e=[],n=0;n<this.sizeX;n++)e.push(" ");this.lines.push(e)}},t.prototype.stop=function(){this.runs=!1,this.stopTime=Date.now(),console.info("Gameloop stopped")},t.prototype.deltaTime=function(){return.001*(Date.now()-this.lastTick)},t.prototype.drawEntity=function(t){var e=this,n=t.sprite.getCells();Object.entries(n).forEach((function(n){var i=n[0],s=n[1];Object.entries(s).forEach((function(n){var s=n[0],r=n[1];r&&e.drawWithPlayerOffset(r,t.elementClass,t.x+parseInt(s),t.y+parseInt(i))}))}))},t.prototype.drawWithPlayerOffset=function(t,e,n,i){var s=this.sizeX/2-this.player.x+n,r=this.sizeY/2-this.player.y+i;s>0&&s<this.sizeX&&r>0&&r<this.sizeY&&(this.lines[r][s]=e?'<span class="'+e+'">'+t+"</span>":t)},t.prototype.drawRoom=function(){var t=this;Object.entries(this.room.tiles).forEach((function(e){var n=e[0],i=e[1];Object.entries(i).forEach((function(e){var i=e[0],s=e[1],r=null;s.is_visible||(r="mapNotVisible"),t.drawWithPlayerOffset(s.char,r,parseInt(i),parseInt(n))}))}))},t.prototype.render=function(){var t=this;this.clearLines(),this.drawRoom(),this.drawEntity(this.player),Object.entries(this.otherPlayers).forEach((function(e){e[0];var n=e[1];t.drawEntity(n)})),Object.entries(this.entities).forEach((function(e){e[0];var n=e[1];t.drawEntity(n)}));var e=[];this.lines.forEach((function(t){e.push(t.join(""))})),this.gameDiv.innerHTML=e.join("\n"),this.guiDiv.innerHTML="fps: "+this.currentFps},t.prototype.update=function(){this.render();var t=this.deltaTime();this.player.tickSpriteState(t),Object.entries(this.otherPlayers).forEach((function(e){e[0];e[1].tickSpriteState(t)})),Object.entries(this.entities).forEach((function(e){e[0];var n=e[1];n.isVisible&&n.tickSpriteState(t)}))},t.prototype.play=function(){var t=this,e=function(){try{if(setTimeout((function(){window.requestAnimFrame(e)}),1e3/t.currentFps),t.update(),t.lastTick=Date.now(),!t.runs)return!1}catch(e){console.error(e.stack),t.stop()}};e()},t}())(document.getElementById("container"),document.getElementById("gui"))}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2tleWJvYXJkLmpzIiwid2VicGFjazovLy8uL3NyYy9yb29tLnRzIiwid2VicGFjazovLy8uL3NyYy9lbnRpdGllcy9lbnRpdHkudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2VudGl0aWVzL3Nwcml0ZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbC9tYXRoLnRzIiwid2VicGFjazovLy8uL3NyYy9lbnRpdGllcy9wbGF5ZXIudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2VudGl0aWVzL3R5cGVMb29rdXAudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2VudGl0aWVzL2Jsb2IudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWVsb29wLnRzIiwid2VicGFjazovLy8uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImtleWJvYXJkIiwiaXNEb3duIiwiaXNVcCIsInByZXNzIiwidW5kZWZpbmVkIiwicmVsZWFzZSIsImRvd25IYW5kbGVyIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInVwSGFuZGxlciIsImRvd25MaXN0ZW5lciIsInVwTGlzdGVuZXIiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwidW5zdWJzY3JpYmUiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic2VlbiIsImlzX3Zpc2libGUiLCJ0aGlzIiwiY2hhciIsIlRpbGVDaGFycyIsInRpbGVzIiwic2V0VGlsZSIsIngiLCJ5IiwiVGlsZSIsInVwZGF0ZVJvb20iLCJ1cGRhdGVEYXRhIiwiZm9yRWFjaCIsInRpbGUiLCJzcHJpdGVTdGF0ZSIsImRpcmVjdGlvbiIsInVwZGF0ZSIsInBhY2tldCIsImlzVmlzaWJsZSIsInRpY2tTcHJpdGVTdGF0ZSIsImR0Iiwic3ByaXRlIiwidGljayIsImlzX3JhbmRvbSIsIm1zRnJvbSIsIm1zVG8iLCJjZWxscyIsImlkeCIsImlzUmFuZG9tIiwibWFrZUN1cnJlbnRGcmFtZSIsIm1pbiIsIm1heCIsIm1zIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiQ3VycmVudEZyYW1lIiwidGltZXIiLCJzcHJpdGVEYXRhIiwic3RhdGVzIiwibG9hZCIsImNvbnNvbGUiLCJsb2ciLCJjdXJyZW50U3RhdGUiLCJjdXJyZW50RGlyZWN0aW9uIiwiY3VycmVudEZyYW1lIiwiZ2V0Q3VycmVudFN0YXRlRnJhbWVzIiwiZW50cmllcyIsInN0YXRlIiwiZGlyZWN0aW9ucyIsImZyYW1lcyIsImZyYW1lIiwiaW5kZXgiLCJsZW5ndGgiLCJwdXNoIiwiZ2V0Q2VsbHMiLCJuZXh0RnJhbWVJbmRleCIsImVsZW1lbnRDbGFzcyIsImhpdFBvaW50cyIsIlNwcml0ZSIsInBsYXllciIsIkVudGl0eSIsImVudGl0eUNsYXNzZXMiLCJibG9iIiwicmVxdWVzdEFuaW1GcmFtZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSIsIm1velJlcXVlc3RBbmltYXRpb25GcmFtZSIsIm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtc1JlcXVlc3RBbmltYXRpb25GcmFtZSIsImNhbGxiYWNrIiwic2V0VGltZW91dCIsImdhbWVEaXYiLCJndWlEaXYiLCJzaXplWCIsInNpemVZIiwibGluZXMiLCJyb29tIiwiUm9vbSIsIm90aGVyUGxheWVycyIsImVudGl0aWVzIiwic29ja2V0IiwiaW5pdCIsImluaXROZXR3b3JrIiwiaW5pdEtleXMiLCJ1cGRhdGVTdGF0ZUZyb21OZXR3b3JrIiwidWlkIiwicGxheWVyRGF0YSIsImVudGl0eURhdGEiLCJlbnRpdHlDbGFzcyIsIldlYlNvY2tldCIsIm9ub3BlbiIsIm9ubWVzc2FnZSIsIkpTT04iLCJwYXJzZSIsImRhdGEiLCJ0eXBlIiwic3RhcnQiLCJzZW5kIiwic3RyaW5naWZ5IiwibGVmdCIsInVwIiwicmlnaHQiLCJkb3duIiwicnVucyIsImdhbWVPYmplY3RzIiwiZnBzIiwiX2ZwcyIsImN1cnJlbnRGcHMiLCJ3YXJuIiwic3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsImxhc3RUaWNrIiwicGxheSIsImluZm8iLCJjbGVhckxpbmVzIiwibGluZSIsInN0b3AiLCJzdG9wVGltZSIsImRlbHRhVGltZSIsImRyYXdFbnRpdHkiLCJlbnRpdHkiLCJ5SW5kZXgiLCJyb3ciLCJ4SW5kZXgiLCJkcmF3V2l0aFBsYXllck9mZnNldCIsInBhcnNlSW50IiwiYWJzb2x1dGVYIiwiYWJzb2x1dGVZIiwiZHJhd1Jvb20iLCJyZW5kZXIiLCJvdGhlclBsYXllciIsImxpbmVzVG9EcmF3Iiwiam9pbiIsImlubmVySFRNTCIsInNlbGYiLCJuZXh0VGltZW91dCIsImUiLCJlcnJvciIsInN0YWNrIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9E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IFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDIpO1xuIiwiLy8gc3RvbGVuIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2tpdHR5a2F0YXR0YWNrL2xlYXJuaW5nUGl4aSNrZXlib2FyZFxuXG5cbmV4cG9ydCBmdW5jdGlvbiBrZXlib2FyZCh2YWx1ZSkge1xuICBsZXQga2V5ID0ge307XG4gIGtleS52YWx1ZSA9IHZhbHVlO1xuICBrZXkuaXNEb3duID0gZmFsc2U7XG4gIGtleS5pc1VwID0gdHJ1ZTtcbiAga2V5LnByZXNzID0gdW5kZWZpbmVkO1xuICBrZXkucmVsZWFzZSA9IHVuZGVmaW5lZDtcbiAgLy9UaGUgYGRvd25IYW5kbGVyYFxuICBrZXkuZG93bkhhbmRsZXIgPSBldmVudCA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0ga2V5LnZhbHVlKSB7XG4gICAgICBpZiAoa2V5LmlzVXAgJiYga2V5LnByZXNzKSBrZXkucHJlc3MoKTtcbiAgICAgIGtleS5pc0Rvd24gPSB0cnVlO1xuICAgICAga2V5LmlzVXAgPSBmYWxzZTtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICB9O1xuXG4gIC8vVGhlIGB1cEhhbmRsZXJgXG4gIGtleS51cEhhbmRsZXIgPSBldmVudCA9PiB7XG4gICAgaWYgKGV2ZW50LmtleSA9PT0ga2V5LnZhbHVlKSB7XG4gICAgICBpZiAoa2V5LmlzRG93biAmJiBrZXkucmVsZWFzZSkga2V5LnJlbGVhc2UoKTtcbiAgICAgIGtleS5pc0Rvd24gPSBmYWxzZTtcbiAgICAgIGtleS5pc1VwID0gdHJ1ZTtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICB9O1xuXG4gIC8vQXR0YWNoIGV2ZW50IGxpc3RlbmVyc1xuICBjb25zdCBkb3duTGlzdGVuZXIgPSBrZXkuZG93bkhhbmRsZXIuYmluZChrZXkpO1xuICBjb25zdCB1cExpc3RlbmVyID0ga2V5LnVwSGFuZGxlci5iaW5kKGtleSk7XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgXCJrZXlkb3duXCIsIGRvd25MaXN0ZW5lciwgZmFsc2VcbiAgKTtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgXCJrZXl1cFwiLCB1cExpc3RlbmVyLCBmYWxzZVxuICApO1xuXG4gIC8vIERldGFjaCBldmVudCBsaXN0ZW5lcnNcbiAga2V5LnVuc3Vic2NyaWJlID0gKCkgPT4ge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBkb3duTGlzdGVuZXIpO1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdXBMaXN0ZW5lcik7XG4gIH07XG5cbiAgcmV0dXJuIGtleTtcbn0iLCJjbGFzcyBUaWxlIHtcbiAgICBuYW1lOiBzdHJpbmdcbiAgICBzZWVuOiBib29sZWFuXG4gICAgaXNfdmlzaWJsZTogYm9vbGVhblxuICAgIGNoYXI6IHN0cmluZ1xuXG4gICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nLCBzZWVuOiBib29sZWFuLCBpc192aXNpYmxlOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWVcbiAgICAgICAgdGhpcy5zZWVuID0gc2VlblxuICAgICAgICB0aGlzLmlzX3Zpc2libGUgPSBpc192aXNpYmxlXG4gICAgICAgIHRoaXMuY2hhciA9IFRpbGVDaGFyc1t0aGlzLm5hbWVdXG4gICAgfVxufVxuXG5jb25zdCBUaWxlQ2hhcnM6IHsgW2luZGV4OiBzdHJpbmddOiBzdHJpbmcgfSA9IHtcbiAgICAnd2FsbCc6ICcjJyxcbiAgICAnZmxvb3InOiAnLidcbn1cblxuZXhwb3J0IGNsYXNzIFJvb20ge1xuICAgIC8vIHRpbGVzW3ldW3hdOiB0aWxlXG4gICAgdGlsZXM6IHsgW2lkOiBzdHJpbmddOiB7IFtpZDogc3RyaW5nXTogVGlsZSB9IH1cblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnRpbGVzID0ge31cbiAgICB9XG5cbiAgICBzZXRUaWxlKHg6IG51bWJlciwgeTogbnVtYmVyLCBuYW1lOiBzdHJpbmcsIHNlZW46IGJvb2xlYW4sIGlzX3Zpc2libGU6IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKCF0aGlzLnRpbGVzW3ldKSB7XG4gICAgICAgICAgICB0aGlzLnRpbGVzW3ldID0ge31cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRpbGVzW3ldW3hdID0gbmV3IFRpbGUobmFtZSwgc2VlbiwgaXNfdmlzaWJsZSlcbiAgICB9XG5cbiAgICB1cGRhdGVSb29tKHVwZGF0ZURhdGE6IEFycmF5PGFueT4pIHtcbiAgICAgICAgdXBkYXRlRGF0YS5mb3JFYWNoKCh0aWxlOiBhbnkpID0+IHtcbiAgICAgICAgICAgIGxldCBbeCwgeV0gPSB0aWxlWzBdXG4gICAgICAgICAgICBsZXQgbmFtZSA9IHRpbGVbMV1cbiAgICAgICAgICAgIGxldCBbc2VlbiwgaXNfdmlzaWJsZV0gPSB0aWxlWzJdXG4gICAgICAgICAgICB0aGlzLnNldFRpbGUoeCwgeSwgbmFtZSwgc2VlbiwgaXNfdmlzaWJsZSlcbiAgICAgICAgfSlcbiAgICB9XG59IiwiaW1wb3J0IHtyYW5kb21JbnRGcm9tSW50ZXJ2YWx9IGZyb20gXCIuLi91dGlsL21hdGhcIjtcbmltcG9ydCB7U3ByaXRlfSBmcm9tIFwiLi9zcHJpdGVcIjtcblxuXG5cbmV4cG9ydCBjbGFzcyBFbnRpdHkge1xuICAgIHNwcml0ZTogU3ByaXRlXG4gICAgeDogbnVtYmVyXG4gICAgeTogbnVtYmVyXG4gICAgXG4gICAgc3ByaXRlU3RhdGU6IHN0cmluZ1xuICAgIGRpcmVjdGlvbjogc3RyaW5nXG4gICAgXG4gICAgZWxlbWVudENsYXNzOiBzdHJpbmdcblxuICAgIGhpdFBvaW50czogbnVtYmVyXG4gICAgXG4gICAgaXNWaXNpYmxlOiBib29sZWFuXG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy54ID0gMFxuICAgICAgICB0aGlzLnkgPSAwXG4gICAgICAgIHRoaXMuc3ByaXRlU3RhdGUgPSAnaWRsZSdcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAncmlnaHQnXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogYXBwbHkgc3RhdGUgdXBkYXRlIGZyb20gbmV0d29ya1xuICAgICAqIFxuICAgICAqIEBwYXJhbSBwYWNrZXRcbiAgICAgKi9cbiAgICB1cGRhdGUocGFja2V0OiBhbnkpIHtcbiAgICAgICAgW3RoaXMueCwgdGhpcy55XSA9IHBhY2tldFsnY29vcmRzJ11cbiAgICAgICAgdGhpcy5zcHJpdGVTdGF0ZSA9IHBhY2tldFsnc3ByaXRlX3N0YXRlJ11cbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBwYWNrZXRbJ2RpcmVjdGlvbiddXG4gICAgICAgIHRoaXMuaXNWaXNpYmxlID0gcGFja2V0Wydpc192aXNpYmxlJ11cbiAgICAgICAgLy90aGlzLmNvbG9yID0gcGFja2V0Wydjb2xvciddXG4gICAgICAgIC8vdGhpcy5zcHJpdGVfc3RhdGUgPSB1cGRhdGVfZGF0YVsnc3ByaXRlX3N0YXRlJ11cbiAgICB9XG4gICAgXG4gICAgdGlja1Nwcml0ZVN0YXRlKGR0OiBudW1iZXIpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ3RpY2tpbmcgc3ByaXRlICcsIGR0KVxuICAgICAgICB0aGlzLnNwcml0ZS50aWNrKGR0LCB0aGlzLnNwcml0ZVN0YXRlLCB0aGlzLmRpcmVjdGlvbilcbiAgICB9XG59IiwiaW1wb3J0IHtyYW5kb21JbnRGcm9tSW50ZXJ2YWx9IGZyb20gXCIuLi91dGlsL21hdGhcIjtcblxuY2xhc3MgRnJhbWUge1xuICAgIGlzUmFuZG9tOiBib29sZWFuXG4gICAgbXNGcm9tOiBudW1iZXJcbiAgICBtc1RvOiBudW1iZXJcbiAgICBjZWxsczogQXJyYXk8QXJyYXk8c3RyaW5nPj5cbiAgICBpZHg6IG51bWJlclxuXG4gICAgY29uc3RydWN0b3IoaXNfcmFuZG9tOiBib29sZWFuLFxuICAgICAgICAgICAgICAgIG1zRnJvbTogbnVtYmVyLFxuICAgICAgICAgICAgICAgIG1zVG86IG51bWJlcixcbiAgICAgICAgICAgICAgICBjZWxsczogQXJyYXk8QXJyYXk8c3RyaW5nPj4sXG4gICAgICAgICAgICAgICAgaWR4OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5pc1JhbmRvbSA9IGlzX3JhbmRvbVxuXG4gICAgICAgIHRoaXMubXNGcm9tID0gbXNGcm9tXG4gICAgICAgIHRoaXMubXNUbyA9IG1zVG9cbiAgICAgICAgdGhpcy5jZWxscyA9IGNlbGxzXG4gICAgICAgIHRoaXMuaWR4ID0gaWR4XG4gICAgfVxuXG4gICAgbWFrZUN1cnJlbnRGcmFtZSgpIHtcbiAgICAgICAgbGV0IG1zID0gdGhpcy5tc0Zyb21cbiAgICAgICAgaWYgKHRoaXMuaXNSYW5kb20pIHtcbiAgICAgICAgICAgIG1zID0gcmFuZG9tSW50RnJvbUludGVydmFsKHRoaXMubXNGcm9tLCB0aGlzLm1zVG8pXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBDdXJyZW50RnJhbWUobXMsIHRoaXMuY2VsbHMsIHRoaXMuaWR4LCAwKVxuICAgIH1cbn1cblxuY2xhc3MgQ3VycmVudEZyYW1lIHtcbiAgICBtczogbnVtYmVyXG4gICAgY2VsbHM6IEFycmF5PEFycmF5PHN0cmluZz4+XG4gICAgaWR4OiBudW1iZXJcbiAgICB0aW1lcjogbnVtYmVyXG5cbiAgICBjb25zdHJ1Y3RvcihtczogbnVtYmVyLFxuICAgICAgICAgICAgICAgIGNlbGxzOiBBcnJheTxBcnJheTxzdHJpbmc+PixcbiAgICAgICAgICAgICAgICBpZHg6IG51bWJlcixcbiAgICAgICAgICAgICAgICB0aW1lcjogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMubXMgPSBtc1xuICAgICAgICB0aGlzLmNlbGxzID0gY2VsbHNcbiAgICAgICAgdGhpcy5pZHggPSBpZHhcbiAgICAgICAgdGhpcy50aW1lciA9IHRpbWVyXG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgU3ByaXRlIHtcbiAgICBzdGF0ZXM6IGFueVxuICAgIGN1cnJlbnRTdGF0ZTogc3RyaW5nXG4gICAgY3VycmVudERpcmVjdGlvbjogc3RyaW5nXG5cbiAgICBjdXJyZW50RnJhbWU6IEN1cnJlbnRGcmFtZVxuXG4gICAgY29uc3RydWN0b3Ioc3ByaXRlRGF0YTogYW55KSB7XG4gICAgICAgIHRoaXMuc3RhdGVzID0ge31cbiAgICAgICAgdGhpcy5sb2FkKHNwcml0ZURhdGEpXG4gICAgICAgIGNvbnNvbGUubG9nKCdzcHJpdGUgc3RhdGVzJywgdGhpcy5zdGF0ZXMpXG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRlID0gJ2lkbGUnXG4gICAgICAgIHRoaXMuY3VycmVudERpcmVjdGlvbiA9ICdyaWdodCdcbiAgICAgICAgdGhpcy5jdXJyZW50RnJhbWUgPSB0aGlzLmdldEN1cnJlbnRTdGF0ZUZyYW1lcygpWzBdLm1ha2VDdXJyZW50RnJhbWUoKVxuXG4gICAgfVxuXG4gICAgbG9hZChzcHJpdGVEYXRhOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2xvYWRpbmcgc3ByaXRlIGRhdGEnLCBzcHJpdGVEYXRhKVxuICAgICAgICBPYmplY3QuZW50cmllcyhzcHJpdGVEYXRhKS5mb3JFYWNoKChbc3RhdGUsIGRpcmVjdGlvbnNdKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlc1tzdGF0ZV0gPSB7fVxuICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMoZGlyZWN0aW9ucykuZm9yRWFjaCgoW2RpcmVjdGlvbiwgZnJhbWVzXSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVzW3N0YXRlXVtkaXJlY3Rpb25dID0gW11cbiAgICAgICAgICAgICAgICBmcmFtZXMuZm9yRWFjaCgoZnJhbWU6IGFueSwgaW5kZXg6IG51bWJlcikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgICAgICAgICAgLSBtczogWzUwMCwgMTAwMF1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmRvbTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbHM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIFsgfiAsIFwiX1wiLCBcIiBcIiwgIH4gXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFtcIihcIiwgXCJfXCIsIFwiX1wiLCBcIilcIl1cbiAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgbGV0IG1zRnJvbSA9IDBcbiAgICAgICAgICAgICAgICAgICAgbGV0IG1zVG8gPSBudWxsXG4gICAgICAgICAgICAgICAgICAgIGlmIChmcmFtZVsnbXMnXS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtc0Zyb20gPSBmcmFtZVsnbXMnXVswXVxuICAgICAgICAgICAgICAgICAgICAgICAgbXNUbyA9IGZyYW1lWydtcyddWzFdXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtc0Zyb20gPSBmcmFtZVsnbXMnXVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZyYW1lID0gbmV3IEZyYW1lKGZyYW1lWydyYW5kb20nXSwgbXNGcm9tLCBtc1RvLCBmcmFtZVsnY2VsbHMnXSwgaW5kZXgpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGVzW3N0YXRlXVtkaXJlY3Rpb25dLnB1c2goZnJhbWUpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgZ2V0Q3VycmVudFN0YXRlRnJhbWVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZXNbdGhpcy5jdXJyZW50U3RhdGVdW3RoaXMuY3VycmVudERpcmVjdGlvbl1cbiAgICB9XG4gICAgXG4gICAgZ2V0Q2VsbHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRGcmFtZS5jZWxsc1xuICAgIH1cbiAgICBcbiAgICB0aWNrKGR0OiBudW1iZXIsIHN0YXRlOiBzdHJpbmcsIGRpcmVjdGlvbjogc3RyaW5nKSB7XG4gICAgICAgIC8vIGlmIHdlIGFyZSBkb2luZyB0aGlzIGZvciB0aGUgZmlyc3QgdGltZSBvciBzb21ldGhpbmcgY2hhbmdlZFxuICAgICAgICBpZiAoIXRoaXMuY3VycmVudFN0YXRlIHx8IHN0YXRlICE9IHRoaXMuY3VycmVudFN0YXRlIHx8IGRpcmVjdGlvbiAhPSB0aGlzLmN1cnJlbnREaXJlY3Rpb24pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCduZXcgc3RhdGUnLCB0aGlzLmN1cnJlbnRTdGF0ZSwgdGhpcy5jdXJyZW50RGlyZWN0aW9uKVxuICAgICAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUgPSBzdGF0ZVxuICAgICAgICAgICAgdGhpcy5jdXJyZW50RGlyZWN0aW9uID0gZGlyZWN0aW9uXG4gICAgICAgICAgICBsZXQgZnJhbWUgPSB0aGlzLmdldEN1cnJlbnRTdGF0ZUZyYW1lcygpWzBdXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRGcmFtZSA9IGZyYW1lLm1ha2VDdXJyZW50RnJhbWUoKVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGhlIGFjdHVhbCB0aWNrXG4gICAgICAgIHRoaXMuY3VycmVudEZyYW1lLnRpbWVyICs9IGR0XG5cbiAgICAgICAgLy8gc2V0IG5leHQgZnJhbWUsIGlmIHRpbWVyIG92ZXIgbXMgZm9yIHRoaXMgZnJhbWVcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEZyYW1lLnRpbWVyPiB0aGlzLmN1cnJlbnRGcmFtZS5tcyAvIDEwMDApIHtcbiAgICAgICAgICAgIGxldCBuZXh0RnJhbWVJbmRleCA9ICh0aGlzLmN1cnJlbnRGcmFtZS5pZHggKyAxKSAlIHRoaXMuZ2V0Q3VycmVudFN0YXRlRnJhbWVzKCkubGVuZ3RoXG4gICAgICAgICAgICBsZXQgZnJhbWUgPSB0aGlzLmdldEN1cnJlbnRTdGF0ZUZyYW1lcygpW25leHRGcmFtZUluZGV4XVxuICAgICAgICAgICAgdGhpcy5jdXJyZW50RnJhbWUgPSBmcmFtZS5tYWtlQ3VycmVudEZyYW1lKClcbiAgICAgICAgfVxuICAgIH1cblxuXG59IiwiZXhwb3J0IGZ1bmN0aW9uIHJhbmRvbUludEZyb21JbnRlcnZhbChtaW46IG51bWJlciwgbWF4OiBudW1iZXIpIHsgLy8gbWluIGFuZCBtYXggaW5jbHVkZWRcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpICsgbWluKTtcbn0iLCJpbXBvcnQge0VudGl0eX0gZnJvbSBcIi4vZW50aXR5XCI7XG5cbi8vIEB0cy1pZ25vcmVcbmltcG9ydCBwbGF5ZXJfc3ByaXRlIGZyb20gJy4vc3ByaXRlcy9wbGF5ZXIueWFtbCdcbmltcG9ydCB7U3ByaXRlfSBmcm9tIFwiLi9zcHJpdGVcIjtcblxuZXhwb3J0IGNsYXNzIFBsYXllciBleHRlbmRzIEVudGl0eSB7XG4gICAgc3ByaXRlOiBhbnlcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmVsZW1lbnRDbGFzcyA9ICdwbGF5ZXInXG4gICAgICAgIHRoaXMuaGl0UG9pbnRzID0gMTAwXG4gICAgICAgIHRoaXMuc3ByaXRlID0gbmV3IFNwcml0ZShwbGF5ZXJfc3ByaXRlKVxuICAgIH1cblxuICAgIHVwZGF0ZShwYWNrZXQ6IGFueSkge1xuICAgICAgICBzdXBlci51cGRhdGUocGFja2V0KVxuXG4gICAgICAgIGlmIChwYWNrZXRbJ2hpdF9wb2ludHMnXSA8IHRoaXMuaGl0UG9pbnRzKSB7XG4gICAgICAgICAgICAvL3RoaXMuc3ByaXRlLmFkZF9jdXJyZW50X2VmZmVjdChtcyA9IDEwMCwgY29sb3IgPSAxOTYpXG4gICAgICAgICAgICB0aGlzLmhpdFBvaW50cyA9IHBhY2tldFsnaGl0X3BvaW50cyddXG4gICAgICAgIH1cblxuICAgIH1cbn0iLCJpbXBvcnQge0VudGl0eX0gZnJvbSBcIi4vZW50aXR5XCI7XG5pbXBvcnQge0Jsb2J9IGZyb20gXCIuL2Jsb2JcIjtcblxuZXhwb3J0IGNvbnN0IGVudGl0eUNsYXNzZXM6IHtbdHlwZTogc3RyaW5nXTogdHlwZW9mIEVudGl0eX0gPSB7XG4gICAgJ2Jsb2InOiBCbG9iXG59IiwiaW1wb3J0IHtFbnRpdHl9IGZyb20gXCIuL2VudGl0eVwiO1xuXG4vLyBAdHMtaWdub3JlXG5pbXBvcnQgYmxvYl9zcHJpdGUgZnJvbSBcIi4vc3ByaXRlcy9ibG9iLnlhbWxcIjtcbmltcG9ydCB7U3ByaXRlfSBmcm9tIFwiLi9zcHJpdGVcIjtcblxuXG5cbmV4cG9ydCBjbGFzcyBCbG9iIGV4dGVuZHMgRW50aXR5IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5lbGVtZW50Q2xhc3MgPSAnYmxvYidcbiAgICAgICAgdGhpcy5oaXRQb2ludHMgPSAxMDBcbiAgICAgICAgdGhpcy5zcHJpdGUgPSBuZXcgU3ByaXRlKGJsb2Jfc3ByaXRlKVxuICAgIH1cbiAgICBcbn0iLCIvLyBodHRwczovL2dpdGh1Yi5jb20vYXhsd2FpaS9HYW1lbG9vcEpTL2Jsb2IvbWFzdGVyL3NyYy9nYW1lbG9vcGpzLmNvcmUuanNcblxuaW1wb3J0ICogYXMgayBmcm9tIFwiLi9rZXlib2FyZFwiO1xuaW1wb3J0IHtSb29tfSBmcm9tIFwiLi9yb29tXCI7XG5pbXBvcnQge1BsYXllcn0gZnJvbSBcIi4vZW50aXRpZXMvcGxheWVyXCI7XG5pbXBvcnQge0VudGl0eX0gZnJvbSBcIi4vZW50aXRpZXMvZW50aXR5XCI7XG5pbXBvcnQge2VudGl0eUNsYXNzZXN9IGZyb20gXCIuL2VudGl0aWVzL3R5cGVMb29rdXBcIjtcblxuKDxhbnk+d2luZG93KS5yZXF1ZXN0QW5pbUZyYW1lID0gKGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHJldHVybiAoXG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAoPGFueT53aW5kb3cpLm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAoPGFueT53aW5kb3cpLm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgKDxhbnk+d2luZG93KS5tc1JlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuXG4gICAgICAgIC8vIEZhbGxiYWNrXG4gICAgICAgIGZ1bmN0aW9uIChjYWxsYmFjazogYW55KSB7XG4gICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChjYWxsYmFjaywgMTAwMCAvIDMwKTtcbiAgICAgICAgfVxuXG4gICAgKTtcblxufSgpKTtcblxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHYW1lTG9vcCB7XG4gICAgZ2FtZURpdjogYW55XG4gICAgZ3VpRGl2OiBhbnlcbiAgICBydW5zOiBib29sZWFuXG4gICAgZ2FtZU9iamVjdHM6IEFycmF5PGFueT5cblxuICAgIGN1cnJlbnRGcHM6IG51bWJlclxuICAgIHN0YXJ0VGltZTogbnVtYmVyXG4gICAgbGFzdFRpY2s6IG51bWJlclxuICAgIHN0b3BUaW1lOiBudW1iZXJcblxuICAgIHNpemVYOiBudW1iZXJcbiAgICBzaXplWTogbnVtYmVyXG5cbiAgICBsaW5lczogQXJyYXk8QXJyYXk8c3RyaW5nPj5cblxuICAgIHNvY2tldDogV2ViU29ja2V0XG5cbiAgICByb29tOiBSb29tXG5cbiAgICBwbGF5ZXI6IFBsYXllclxuICAgIG90aGVyUGxheWVyczogeyBbdWlkOiBzdHJpbmddOiBQbGF5ZXIgfVxuICAgIGVudGl0aWVzOiB7IFt1aWQ6IHN0cmluZ106IEVudGl0eSB9XG5cbiAgICBjb25zdHJ1Y3RvcihnYW1lRGl2OiBhbnksIGd1aURpdjogYW55KSB7XG4gICAgICAgIHRoaXMuc2l6ZVggPSA3MFxuICAgICAgICB0aGlzLnNpemVZID0gMzBcblxuICAgICAgICB0aGlzLmdhbWVEaXYgPSBnYW1lRGl2XG4gICAgICAgIHRoaXMuZ3VpRGl2ID0gZ3VpRGl2XG5cbiAgICAgICAgdGhpcy5saW5lcyA9IFtdXG5cbiAgICAgICAgdGhpcy5yb29tID0gbmV3IFJvb20oKVxuICAgICAgICB0aGlzLnBsYXllciA9IG5ldyBQbGF5ZXIoKVxuICAgICAgICB0aGlzLm90aGVyUGxheWVycyA9IHt9XG4gICAgICAgIHRoaXMuZW50aXRpZXMgPSB7fVxuXG4gICAgICAgIHRoaXMuc29ja2V0ID0gbnVsbFxuXG4gICAgICAgIHRoaXMuaW5pdCgpXG4gICAgICAgIHRoaXMuaW5pdE5ldHdvcmsoKVxuICAgICAgICB0aGlzLmluaXRLZXlzKClcbiAgICB9XG5cbiAgICB1cGRhdGVTdGF0ZUZyb21OZXR3b3JrKHBhY2tldDogYW55KSB7XG4gICAgICAgIGlmIChwYWNrZXRbJ2RhdGEnXVsnbWFwJ10pIHtcbiAgICAgICAgICAgIHRoaXMucm9vbS51cGRhdGVSb29tKHBhY2tldFsnZGF0YSddWydtYXAnXSlcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYWNrZXRbJ2RhdGEnXVsnc2VsZiddKSB7XG4gICAgICAgICAgICB0aGlzLnBsYXllci51cGRhdGUocGFja2V0WydkYXRhJ11bJ3NlbGYnXSlcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFja2V0WydkYXRhJ11bJ3BsYXllcnMnXSkge1xuICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMocGFja2V0WydkYXRhJ11bJ3BsYXllcnMnXSkuZm9yRWFjaCgoW3VpZCwgcGxheWVyRGF0YV0pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMub3RoZXJQbGF5ZXJzW3VpZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vdGhlclBsYXllcnNbdWlkXSA9IG5ldyBQbGF5ZXIoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLm90aGVyUGxheWVyc1t1aWRdLnVwZGF0ZShwbGF5ZXJEYXRhKVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFja2V0WydkYXRhJ11bJ2VudGl0aWVzJ10pIHtcbiAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHBhY2tldFsnZGF0YSddWydlbnRpdGllcyddKS5mb3JFYWNoKChbdWlkLCBlbnRpdHlEYXRhXSkgPT4ge1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmVudGl0aWVzW3VpZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVudGl0eUNsYXNzID0gKDxhbnk+ZW50aXR5RGF0YSlbJ3R5cGUnXVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVudGl0aWVzW3VpZF0gPSBuZXcgZW50aXR5Q2xhc3Nlc1tlbnRpdHlDbGFzc10oKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmVudGl0aWVzW3VpZF0udXBkYXRlKGVudGl0eURhdGEpXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5pdE5ldHdvcmsoKSB7XG4gICAgICAgIC8vdGhpcy5zb2NrZXQgPSBuZXcgV2ViU29ja2V0KFwid3M6Ly9sb2NhbGhvc3Q6ODA4MC9jb25uZWN0XCIpO1xuICAgICAgICB0aGlzLnNvY2tldCA9IG5ldyBXZWJTb2NrZXQoXCJ3c3M6Ly9hc2NpaS5rd29oLmRlL2Nvbm5lY3RcIik7XG4gICAgICAgIHRoaXMuc29ja2V0Lm9ub3BlbiA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnY29ubmVjdGVkIScsIGV2ZW50KVxuICAgICAgICAgICAgdGhpcy5zb2NrZXQub25tZXNzYWdlID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHBhY2tldCA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSlcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhY2tldC50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2luaXQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2luaXQgcGFja2FnZSEnKVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZUZyb21OZXR3b3JrKHBhY2tldClcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnQoKVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZSc6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlRnJvbU5ldHdvcmsocGFja2V0KVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncmVtb3ZlX3BsYXllcnMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgcGFja2V0WydkYXRhJ10uZm9yRWFjaCgodWlkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5vdGhlclBsYXllcnNbdWlkXVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdyZW1vdmVfZW50aXRpZXMnOlxuICAgICAgICAgICAgICAgICAgICAgICAgcGFja2V0WydkYXRhJ10uZm9yRWFjaCgodWlkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5lbnRpdGllc1t1aWRdXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndW5rbm93biBwYWNrYWdlICcsIHBhY2tldClcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHNlbmQodHlwZTogc3RyaW5nLCBkYXRhOiBhbnkpIHtcbiAgICAgICAgaWYgKHRoaXMuc29ja2V0KSB7XG4gICAgICAgICAgICB0aGlzLnNvY2tldC5zZW5kKEpTT04uc3RyaW5naWZ5KHt0eXBlOiB0eXBlLCBkYXRhOiBkYXRhfSkpXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpbml0S2V5cygpIHtcbiAgICAgICAgbGV0IGxlZnQgPSBrLmtleWJvYXJkKFwiYVwiKSxcbiAgICAgICAgICAgIHVwID0gay5rZXlib2FyZChcIndcIiksXG4gICAgICAgICAgICByaWdodCA9IGsua2V5Ym9hcmQoXCJkXCIpLFxuICAgICAgICAgICAgZG93biA9IGsua2V5Ym9hcmQoXCJzXCIpO1xuXG4gICAgICAgIGxlZnQucHJlc3MgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlbmQoJ2FjdGlvbnMnLCB7J2xlZnQnOiAncHJlc3MnfSlcbiAgICAgICAgfTtcbiAgICAgICAgbGVmdC5yZWxlYXNlID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZW5kKCdhY3Rpb25zJywgeydsZWZ0JzogJ3JlbGVhc2UnfSlcbiAgICAgICAgfTtcblxuICAgICAgICB1cC5wcmVzcyA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VuZCgnYWN0aW9ucycsIHsndXAnOiAncHJlc3MnfSlcbiAgICAgICAgfTtcbiAgICAgICAgdXAucmVsZWFzZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VuZCgnYWN0aW9ucycsIHsndXAnOiAncmVsZWFzZSd9KVxuICAgICAgICB9O1xuXG4gICAgICAgIHJpZ2h0LnByZXNzID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZW5kKCdhY3Rpb25zJywgeydyaWdodCc6ICdwcmVzcyd9KVxuICAgICAgICB9O1xuICAgICAgICByaWdodC5yZWxlYXNlID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZW5kKCdhY3Rpb25zJywgeydyaWdodCc6ICdyZWxlYXNlJ30pXG4gICAgICAgIH07XG5cbiAgICAgICAgZG93bi5wcmVzcyA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VuZCgnYWN0aW9ucycsIHsnZG93bic6ICdwcmVzcyd9KVxuICAgICAgICB9O1xuICAgICAgICBkb3duLnJlbGVhc2UgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNlbmQoJ2FjdGlvbnMnLCB7J2Rvd24nOiAncmVsZWFzZSd9KVxuICAgICAgICB9O1xuICAgIH1cblxuICAgIGluaXQoKSB7XG4gICAgICAgIHRoaXMucnVucyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmdhbWVPYmplY3RzID0gW107XG4gICAgICAgIHRoaXMuZnBzKDMwKTtcblxuICAgIH07XG5cblxuICAgIC8qIEBkZXNjIGdldHRlciBhbmQgc2V0dGVyIGZvciBmcHNcbiAgICAgKiBAcGFyYW0gX2ZwcyAtIGlmIGRlZmluZWQgZnBzIHdpbGwgYmUgc2V0IHRvIGl0cyB2YWx1ZVxuICAgICAqIEByZXR1cm4gY3VycmVudCBmcHNcbiAgICAgKi9cbiAgICBmcHMoX2ZwczogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuY3VycmVudEZwcyA9IChfZnBzIHx8IHRoaXMuY3VycmVudEZwcyk7XG4gICAgICAgIGxldCBza2lwVGlja3MgPSAxMDAwIC8gdGhpcy5jdXJyZW50RnBzO1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50RnBzO1xuICAgIH07XG5cbiAgICBzdGFydCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZ2FtZU9iamVjdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ05vIGdhbWVPYmplY3RzIGluIHRoZSBHYW1lLicpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICB0aGlzLmxhc3RUaWNrID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdGhpcy5ydW5zID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5wbGF5KCk7XG5cbiAgICAgICAgY29uc29sZS5pbmZvKCdHYW1lbG9vcCBpcyBydW5uaW5nJyk7XG4gICAgfTtcblxuICAgIHByaXZhdGUgY2xlYXJMaW5lcygpIHtcbiAgICAgICAgdGhpcy5saW5lcyA9IFtdXG4gICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdGhpcy5zaXplWTsgeSsrKSB7XG4gICAgICAgICAgICBjb25zdCBsaW5lID0gW11cbiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdGhpcy5zaXplWDsgeCsrKSB7XG4gICAgICAgICAgICAgICAgbGluZS5wdXNoKCcgJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubGluZXMucHVzaChsaW5lKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RvcCgpIHtcbiAgICAgICAgdGhpcy5ydW5zID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RvcFRpbWUgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgIGNvbnNvbGUuaW5mbygnR2FtZWxvb3Agc3RvcHBlZCcpO1xuXG4gICAgfTtcblxuICAgIGRlbHRhVGltZSgpIHtcbiAgICAgICAgcmV0dXJuIDAuMDAxICogKERhdGUubm93KCkgLSB0aGlzLmxhc3RUaWNrKTtcbiAgICB9XG5cblxuICAgIHByaXZhdGUgZHJhd0VudGl0eShlbnRpdHk6IEVudGl0eSkge1xuICAgICAgICBsZXQgY2VsbHMgPSBlbnRpdHkuc3ByaXRlLmdldENlbGxzKClcblxuICAgICAgICBPYmplY3QuZW50cmllcyhjZWxscykuZm9yRWFjaCgoW3lJbmRleCwgcm93XSkgPT4ge1xuICAgICAgICAgICAgT2JqZWN0LmVudHJpZXMocm93KS5mb3JFYWNoKChbeEluZGV4LCBjaGFyXSkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjaGFyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd1dpdGhQbGF5ZXJPZmZzZXQoY2hhciwgZW50aXR5LmVsZW1lbnRDbGFzcywgZW50aXR5LnggKyBwYXJzZUludCh4SW5kZXgpLCBlbnRpdHkueSArIHBhcnNlSW50KHlJbmRleCkpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBwcml2YXRlIGRyYXdXaXRoUGxheWVyT2Zmc2V0KGNoYXI6IHN0cmluZywgZWxlbWVudENsYXNzOiBzdHJpbmcsIHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgICAgIGxldCBjZW50cmVfeCA9ICh0aGlzLnNpemVYIC8gMikgLSB0aGlzLnBsYXllci54XG4gICAgICAgIGxldCBjZW50cmVfeSA9ICh0aGlzLnNpemVZIC8gMikgLSB0aGlzLnBsYXllci55XG5cbiAgICAgICAgbGV0IGFic29sdXRlWCA9IGNlbnRyZV94ICsgeFxuICAgICAgICBsZXQgYWJzb2x1dGVZID0gY2VudHJlX3kgKyB5XG4gICAgICAgIGlmIChhYnNvbHV0ZVggPiAwICYmIGFic29sdXRlWCA8IHRoaXMuc2l6ZVhcbiAgICAgICAgICAgICYmIGFic29sdXRlWSA+IDAgJiYgYWJzb2x1dGVZIDwgdGhpcy5zaXplWSkge1xuICAgICAgICAgICAgaWYgKCFlbGVtZW50Q2xhc3MpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxpbmVzW2Fic29sdXRlWV1bYWJzb2x1dGVYXSA9IGNoYXJcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5saW5lc1thYnNvbHV0ZVldW2Fic29sdXRlWF0gPSBgPHNwYW4gY2xhc3M9XCIke2VsZW1lbnRDbGFzc31cIj4ke2NoYXJ9PC9zcGFuPmBcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgfVxuXG4gICAgZHJhd1Jvb20oKSB7XG4gICAgICAgIE9iamVjdC5lbnRyaWVzKHRoaXMucm9vbS50aWxlcykuZm9yRWFjaCgoW3lJbmRleCwgcm93XSkgPT4ge1xuICAgICAgICAgICAgICAgIE9iamVjdC5lbnRyaWVzKHJvdykuZm9yRWFjaCgoW3hJbmRleCwgdGlsZV0pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVsZW1lbnRDbGFzcyA9IG51bGxcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aWxlLmlzX3Zpc2libGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRDbGFzcyA9ICdtYXBOb3RWaXNpYmxlJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd1dpdGhQbGF5ZXJPZmZzZXQodGlsZS5jaGFyLCBlbGVtZW50Q2xhc3MsIHBhcnNlSW50KHhJbmRleCksIHBhcnNlSW50KHlJbmRleCkpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cblxuICAgIHJlbmRlcigpIHtcbiAgICAgICAgdGhpcy5jbGVhckxpbmVzKClcblxuICAgICAgICB0aGlzLmRyYXdSb29tKClcbiAgICAgICAgdGhpcy5kcmF3RW50aXR5KHRoaXMucGxheWVyKVxuICAgICAgICBPYmplY3QuZW50cmllcyh0aGlzLm90aGVyUGxheWVycykuZm9yRWFjaCgoW3VpZCwgb3RoZXJQbGF5ZXJdKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRyYXdFbnRpdHkob3RoZXJQbGF5ZXIpXG4gICAgICAgIH0pXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKHRoaXMuZW50aXRpZXMpLmZvckVhY2goKFt1aWQsIGVudGl0eV0pID0+IHtcbiAgICAgICAgICAgIHRoaXMuZHJhd0VudGl0eShlbnRpdHkpXG4gICAgICAgIH0pXG5cbiAgICAgICAgY29uc3QgbGluZXNUb0RyYXc6IEFycmF5PHN0cmluZz4gPSBbXVxuICAgICAgICB0aGlzLmxpbmVzLmZvckVhY2gobGluZSA9PiB7XG4gICAgICAgICAgICBsaW5lc1RvRHJhdy5wdXNoKGxpbmUuam9pbignJykpXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMuZ2FtZURpdi5pbm5lckhUTUwgPSBsaW5lc1RvRHJhdy5qb2luKCdcXG4nKVxuXG4gICAgICAgIHRoaXMuZ3VpRGl2LmlubmVySFRNTCA9ICdmcHM6ICcgKyB0aGlzLmN1cnJlbnRGcHNcbiAgICAgICAgLypcbiAgICAgICAgZm9yIChsZXQgcmVuZGVySSA9IDA7IHJlbmRlckkgPCBnYW1lT2JqZWN0cy5sZW5ndGg7IHJlbmRlckkrKykge1xuICAgICAgICAgICAgdGhpcy5nYW1lT2JqZWN0c1tyZW5kZXJJXS5kcmF3KCk7XG4gICAgICAgIH1cbiAgICAgICAgKi9cblxuICAgIH1cblxuICAgIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcblxuICAgICAgICBjb25zdCBkdCA9IHRoaXMuZGVsdGFUaW1lKClcblxuICAgICAgICB0aGlzLnBsYXllci50aWNrU3ByaXRlU3RhdGUoZHQpXG5cbiAgICAgICAgT2JqZWN0LmVudHJpZXModGhpcy5vdGhlclBsYXllcnMpLmZvckVhY2goKFt1aWQsIG90aGVyUGxheWVyXSkgPT4ge1xuICAgICAgICAgICAgb3RoZXJQbGF5ZXIudGlja1Nwcml0ZVN0YXRlKGR0KVxuICAgICAgICB9KVxuXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKHRoaXMuZW50aXRpZXMpLmZvckVhY2goKFt1aWQsIGVudGl0eV0pID0+IHtcbiAgICAgICAgICAgIGlmIChlbnRpdHkuaXNWaXNpYmxlKSB7XG4gICAgICAgICAgICAgICAgZW50aXR5LnRpY2tTcHJpdGVTdGF0ZShkdClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG5cblxuICAgIHBsYXkoKSB7XG4gICAgICAgIGxldCBzZWxmID0gdGhpc1xuICAgICAgICBsZXQgbmV4dFRpbWVvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAoPGFueT53aW5kb3cpLnJlcXVlc3RBbmltRnJhbWUobmV4dFRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIH0sIDEwMDAgLyBzZWxmLmN1cnJlbnRGcHMpO1xuXG4gICAgICAgICAgICAgICAgc2VsZi51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICBzZWxmLmxhc3RUaWNrID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAgICAgICAgIGlmICghc2VsZi5ydW5zKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlLnN0YWNrKVxuICAgICAgICAgICAgICAgIHNlbGYuc3RvcCgpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuICAgICAgICBuZXh0VGltZW91dCgpXG4gICAgfVxufVxuXG4iLCJpbXBvcnQgKiBhcyBrIGZyb20gJy4va2V5Ym9hcmQnXG5pbXBvcnQgR2FtZSBmcm9tICcuL2dhbWVsb29wJ1xuXG5cbmZ1bmN0aW9uIHNldHVwKCkge1xuICAgIC8vQ2FwdHVyZSB0aGUga2V5Ym9hcmQgYXJyb3cga2V5c1xuXG5cbiAgICBsZXQgZ2FtZSA9IG5ldyBHYW1lKFxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyksXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdndWknKSk7XG59XG5cblxuc2V0dXAoKSJdLCJzb3VyY2VSb290IjoiIn0=